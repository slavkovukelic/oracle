# Oracle Linux Oracle Setup alat

## Pregled

`oracle_setup.py` је модернизовани CLI алат намењен припреми Oracle Linux 8 система за Oracle Database и Fusion Middleware радна оптерећења. Омогућава прилагођавање кернел параметара, системских корисника и директоријума према Oracle препорукама. Поред адаптивног Python начина рада који израчунава подешавања на основу тренутног хардвера, доступан је и „legacy” режим који покреће оригинални `oracle.sh` скрипт за 100% усклађене резултате.

## Инсталација

1. Инсталирајте Python 3.10 или новији (алат подржава и Python 3.11+).
2. (Опционо) Креирајте виртуелно окружење:
   ```bash
   python3 -m venv .venv
   source .venv/bin/activate
   ```
3. Инсталирајте зависности из `requirements.txt`:
   ```bash
   pip install -r requirements.txt
   ```

> Напомена: На Python верзијама старијим од 3.11 потребан је пакет `tomli` како би се учитавао TOML конфигурациони фајл.

## Покретање

Основни пример покретања (dry-run режим који не уписује измене):

```bash
python oracle_setup.py
```

Уколико желите да измене буду примењене на систем, користите `--apply` и покрените скрипт као `root`.

## CLI опције

Све доступне CLI опције можете комбиновати по потреби:

- `--oracle-user <име>` – подразумевано `oracle`; корисник за кога се припремају лимити и директоријуми.
- `--apply` – када је присутно, уписује израчунату конфигурацију на систем (захтева root).
- `--fmw-user <име>` – подразумевано `fmw`; додатни Fusion Middleware корисник.
- `--no-fmw` – онемогућава креирање/ажурирање Fusion Middleware корисника и директоријума.
- `--mode {adaptive,legacy}` – бира да ли се користи Python адаптивни план или историјски `oracle.sh` скрипт.
- `--inspect` – упоређује тренутно стање система са планираном конфигурацијом и приказује неслагања.
- `--verbose` / `-v` – повећава количину логовања (понављањем опције прелази се на debug ниво).
- `--log-file <путања>` – уписује логове у наведени фајл поред излаза на конзолу.
- `--log-format {text,json}` – формат логова (подразумевано `text`).
- `--output <путања>` – уписује израчунати план у JSON фајл (корисно у dry-run режиму).
- `--legacy-script <путања>` – ручно задаје локацију `oracle.sh` скрипта за `legacy` режим.
- `--config <путања>` – чита конфигурацију из TOML документа (подразумевано `oracle_setup.toml`).
- `--update-existing-users` – усклађује постојеће системске кориснике са поставкама из конфигурације.
- `--repo-mode {system,local}` – одређује да ли алат користи постојеће интернет репозиторијуме (`system`) или их привремено замењује локалним ISO/CD-ROM огледалом (`local`).
- `--local-repo-root <путања>` – путања до монтираног Oracle Linux медија када је активан `--repo-mode=local` (подразумевано `/INSTALL`).

## Пример TOML конфигурације

Следећи пример показује све секције које алат подржава. Свака од њих је опционална осим `[paths]` који мора постојати:

```toml
[packages]
install = [
  "kmod-oracle",
  "oracle-database-preinstall-19c"
]

[[groups]]
name = "oinstall"
gid = 54321

[[groups]]
name = "dba"

[[users]]
name = "oracle"
primary_group = "oinstall"
supplementary_groups = ["dba"]
home = "/u01/app/oracle"
shell = "/bin/bash"
uid = 54321
create_home = true

[[users]]
name = "fmw"
primary_group = "oinstall"
supplementary_groups = ["dba"]
home = "/u01/app/fmw"
create_home = true

[paths]
data_root = "/u01"
profile_dir = "/etc/profile.d"
ora_inventory = "/u01/app/oraInventory"
oratab = "/etc/oratab"

[database]
target_version = "19c"
```

### Објашњење секција

- `[packages]` – наводи додатне RPM пакете који треба да буду инсталирани; поље `install` је листа назива пакета.
- `[[groups]]` – сваки унос дефинише системску групу (име и опциони `gid`).
- `[[users]]` – описује кориснике (име, примарну групу, додатне групе, кућни директоријум, опциони `uid`, љуску и да ли се директорјум креира ако не постоји).
- `[paths]` – дефинише кључне путање за Oracle софтвер (`data_root`, `profile_dir`, `ora_inventory`, `oratab`).
- `[database]` – омогућава навођење циљне верзије базе (`target_version`) ради документације и инспекције.

## Legacy режим

Када је `--mode legacy` постављен, алат покреће оригинални `oracle.sh` скрипт. Ово је корисно за команде које захтевају потпуно исте кораке као у постојећим окружењима. Скрипт се покреће нон-интерактивно и захтева root привилегије ако се примењују измене.

---

За додатне информације прегледајте изворни код `oracle_setup.py` и подразумевану конфигурацију `oracle_setup.toml`.
